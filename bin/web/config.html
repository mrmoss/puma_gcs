<html style="width:100%;height:100%;">
	<head>
		<script type="text/javascript">
			var uavs=new Array();

			function initialize()
			{
				setInterval(uav_update,1000);
			}

			function uav_update()
			{
				var xmlhttp=new XMLHttpRequest();

				xmlhttp.onreadystatechange=function()
				{
					if(xmlhttp.readyState==4&&xmlhttp.status==200)
					{
						try
						{
							var return_json=JSON.parse(xmlhttp.responseText);

							if(return_json)
							{
								for(var ii=0;ii<return_json.size;++ii)
									get_status(return_json[ii]);
							}
						}
						catch(e)
						{}
					}
				}

				xmlhttp.open("GET",encodeURIComponent("&uavs=1"),true);
				xmlhttp.send(null);
			}

			function get_status(id)
			{
				var xmlhttp=new XMLHttpRequest();

				xmlhttp.onreadystatechange=function()
				{
					if(xmlhttp.readyState==4&&xmlhttp.status==200)
					{
						try
						{
							var return_json=JSON.parse(xmlhttp.responseText);

							if(return_json)
							{
								var found=false;
								var end=false;

								for(var ii=0;ii<uavs.length;++ii)
								{
									if(uavs[ii].obj.status.id==return_json.status.id)
									{
										found=true;

										if(ii==uavs.length-1)
											end=true;

										uavs[ii].obj=return_json;
										break;
									}
								}

								if(!found)
								{
									uavs.push({"obj":return_json});
								}

								if(end)
									view_uav();
							}
						}
						catch(e)
						{}
					}
				}

				xmlhttp.open("GET",encodeURIComponent("&id="+id+"&status=1"),true);
				xmlhttp.send(null);
			}

			function view_uav()
			{
				var button_begin=" <input type=\"button\" style=\"width:100%;\" value=\"";
				var button_end="\" onclick=\"this.disabled=true\"/>";

				var html="<table border=\"1\">";
				html+="<colgroup>";
				html+="<col span=\"1\" style=\"width:32px;\">";
				html+="<col span=\"1\" style=\"width:128px;\">";
				html+="<col span=\"1\" style=\"width:64px;\">";
				html+="<col span=\"1\" style=\"width:96px;\">";
				html+="<col span=\"1\" style=\"width:80px;\">";
				html+="</colgroup>";
				html+="<tr>";
				html+="<td>"+"id"+"</td>";
				html+="<td>"+"port"+"</td>";
				html+="<td>"+"baud"+"</td>";
				html+="<td>"+"status"+"</td>";
				html+="<td>"+""+"</td>";
				html+="</tr>";

				for(var ii=0;ii<uavs.length;++ii)
				{
					html+="<tr>";
					html+="<td>"+uavs[ii].obj.status.id+"</td>";
					html+="<td>"+uavs[ii].obj.status.serial_port+"</td>";
					html+="<td>"+uavs[ii].obj.status.serial_baud+"</td>";

					if(uavs[ii].obj.status.serial_status==0)
						html+="<td>"+"disconnected"+"</td><td>"+button_begin+"connect"+button_end+"</td>";
					else
						html+="<td>"+"connected"+"</td><td>"+button_begin+"disconnect"+button_end+"</td>";

					html+="</tr>";
				}

				html+="</table>";

				document.getElementById("table").innerHTML=html;

				document.getElementById("entry_id").disabled=false;
				document.getElementById("entry_port").disabled=false;
				document.getElementById("entry_baud").disabled=false;
				document.getElementById("entry_add").disabled=false;
			}

			function add_entry()
			{
				document.getElementById("entry_id").disabled=true;
				document.getElementById("entry_port").disabled=true;
				document.getElementById("entry_baud").disabled=true;
				document.getElementById("entry_add").disabled=true;
			}
		</script>
	</head>
	<body onload="initialize();">
		<title>GCS - Configuration</title>
		<table>
			<tr>
				<td>
					<table border="1">
						<colgroup>
							<col span="1" style="width:32px;">
							<col span="1" style="width:128px;">
							<col span="1" style="width:64px;">
							<col span="1" style="width:64px;">
						</colgroup>
						<tr>
							<td>id</td>
							<td>port</td>
							<td>baud</td>
							<td></td>
						</tr>
						<tr>
							<td><input type="text" style="width:100%;" id="entry_id"/></td>
							<td><input type="text" style="width:100%;" id="entry_port"/></td>
							<td><input type="text" style="width:100%;" id="entry_baud"/></td>
							<td><input type="button" style="width:100%;" id="entry_add" value="add" onclick="add_entry();"/></td>
						</tr>
					</table>
					<br/>
				</td>
			</tr>
			<tr>
				<td>
					<div id="table"></div>
				</td>
			</tr>
		</table>
	</body>
</html>